define([],function(){"use strict";function a(a){console.log(a)}function b(b,e){n(),$.getJSON(b,function(a){$.each(a.sequences[0].canvases,function(a,b){h[b.label]=b}),d=Object.keys(h).length,$("#iiif-ctrl .total-images").html("/ "+d),j(),$("#iiif").removeClass("loading"),i[Object.keys(i)[0]].addTo(c),$(".media-viewer").trigger("object-media-open",{hide_thumb:!0}),l()}).fail(function(b){a("error loading manifest: "+JSON.stringify(b,null,4)),$(".media-viewer").trigger({type:"remove-playability",$thumb:e,player:"iiif"})})}var c,d,e=("undefined"==typeof js_path?"/js/dist/":js_path)+"css/map/application-map.css",f=("undefined"==typeof js_path?"/js/dist/":js_path)+"lib/iiif/iiif.css",g=0,h={},i={};$("head").append('<link rel="stylesheet" href="'+e+'" type="text/css"/>'),$("head").append('<link rel="stylesheet" href="'+f+'" type="text/css"/>');var j=function(a){for(var b=5,c=0,d=a?a:g,e=Math.max(d-parseInt(b/2),0),f=!1;!f;)if(c==b)f=!0;else if(e>=Object.keys(h).length)f=!0;else{var j=Object.keys(h)[e],k=h[j];if(!i[k.label]){var l=L.tileLayer.iiif(k.images[0].resource.service["@id"]+"/info.json");i[k.label]=l,c+=1}e+=1}},k=function(a){for(var b in i)c.hasLayer(i[b])&&i[b]!=a&&c.removeLayer(i[b]);c.addLayer(a)},l=function(){$("#iiif-ctrl .title").html(Object.keys(h)[g]),$("#iiif-ctrl .jump-to-img").val(g+1),$("#iiif-ctrl .first").attr("disabled",0==g),$("#iiif-ctrl .prev").attr("disabled",0==g),$("#iiif-ctrl .next").attr("disabled",g==d-1),$("#iiif-ctrl .last").attr("disabled",g==d-1)},m=function(a,b){if(!a.attr("disabled")){var c=Object.keys(h)[b],d=i[c];d||($("#iiif").addClass("loading"),j(b),d=i[c],$("#iiif").removeClass("loading")),k(d),g=b,l()}},n=function(){$("#iiif").addClass("loading"),c=L.map("iiif",{center:[0,0],crs:L.CRS.Simple,zoom:0}),L.control.fullscreen({position:"topright",forceSeparateButton:!0,forcePseudoFullscreen:!1}).addTo(c),$("#iiif-ctrl .first").on("click",function(a){a.preventDefault(),m($(this),0)}),$("#iiif-ctrl .prev").on("click",function(a){a.preventDefault(),m($(this),g-1)}),$("#iiif-ctrl .next").on("click",function(a){a.preventDefault(),m($(this),g+1)}),$("#iiif-ctrl .last").on("click",function(a){a.preventDefault(),m($(this),d-1)}),$(c._container).bind("keydown",function(a){var b=window.event?a.keyCode:a.which;a=a||window.event,(a.shiftKey||a.ctrlKey)&&(a.stopPropagation(),a.preventDefault(),37==b&&$("#iiif-ctrl .prev").click(),38==b&&$("#iiif-ctrl .first").click(),39==b&&$("#iiif-ctrl .next").click(),40==b&&$("#iiif-ctrl .last").click())}),$("#iiif-ctrl .jump-to-img").bind("keydown",function(a){var b=window.event?a.keyCode:a.which;if(13==b){var c=parseInt($(this).val());!isNaN(c)&&c>0&&d+1>c?m($(this),c-1):$(this).val(g+1)}})};return{init:function(a,c){require(["leaflet_iiif"],function(){b(a,c)})}}});