define(["jquery","media_controller"],function(a){function b(a){console.log(a)}function c(){window.location.href.indexOf("ellipsis")>-1&&a(".mlt-title a").each(function(){for(;a(this).outerHeight()>a(this).parent().height();)a(this).text(function(a,b){return b.replace(/\W*\s(\S)*$/,"...")})})}function d(){var c=function(a){"function"==typeof jQuery&&a instanceof jQuery&&(a=a[0]);var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&b.right<=(window.innerWidth||document.documentElement.clientWidth)};a(window).on("scroll",function(){a(".scroll-trigger[enabled=true]").each(function(){if(c(a(this))){a(this).attr("enabled",!1);var b=a(this).data("fire-on-open"),d=a(this).data("fire-on-open-params");a(window).trigger(b,d)}})}),a(document).ready(function(){a(".scroll-trigger").each(function(){if(c(this)){a(this).attr("enabled",!1);var d=a(this).data("fire-on-open"),e=a(this).data("fire-on-open-params");a(window).trigger(d,e),b("evt: "+d+"  "+e)}})})}function e(){a(".js-showhide").on("click",function(b){var c=a(this),d=a(this).parent();d.find(".js-showhide-panel").toggleClass("is-jshidden"),d.toggleClass("is-expanded"),c.text()===c.data("text-swap")?c.text(c.data("text-original")):(c.data("text-original",c.text()),c.text(c.data("text-swap"))),b.preventDefault()})}function f(c){var d=function(c,d,e){b("initLeaflet:\n	"+JSON.stringify(c)+"\n	"+JSON.stringify(d));var f="map",g="map-info",h=a("#map-place-name").text();require([js_path+"application-map.js"],function(){a("#"+f).after('<div id="'+g+'"></div>');var b='Tiles &copy; <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" alt="mapquest logo"/>',i=new L.TileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.png",{minZoom:4,maxZoom:18,attribution:b,subdomains:"1234",type:"osm"}),j=L.map(f,{center:new L.LatLng(d[0],c[0]),zoomControl:!0,zoom:8});L.Icon.Default.imagePath=js_path+"css/map/images",j.addLayer(i),j.invalidateSize();for(var k=[],l=0;l<Math.min(d.length,c.length);l++)L.marker([d[l],c[l]]).addTo(j),k.push(d[l]+"&deg; "+(d[l]>0?e.n:e.s)+", "+c[l]+"&deg; "+(c[l]>0?e.e:e.w));h=h?h.toUpperCase()+" ":"",a("#"+g).html(h+(k.length?" "+k.join(", "):"")),a("head").append('<link rel="stylesheet" href="'+js_path+'css/map/application-map.css" type="text/css"/>')})},e=(c.latitude+"").split(/,*\s+/g),f=(c.longitude+"").split(/,*\s+/g);if(e&&f){for(var g=0;g<e.length;g++)e[g]=e[g].replace(/,/g,".").indexOf(".")>-1?e[g]:e[g]+".00";for(var g=0;g<f.length;g++)f[g]+f[g].replace(/,/g,".").indexOf(".")>-1?f[g]:f[g]+".00";for(var h=[],i=[],g=0;g<Math.min(e.length,f.length);g++)e[g]&&f[g]&&[e[g]+"",f[g]+""].join(",").match(/^\s*-?\d+\.\d+\,\s?-?\d+\.\d+\s*$/)?(h.push(f[g]),i.push(e[g])):b("Map data error: invalid coordinate pair:\n	"+h[g]+"\n	"+i[g]);h.length&&i.length?d(h,i,c.labels):b("Map data missing")}}function g(){"undefined"!=typeof c&&c(),e(),a(window).bind("showMLT",function(a,b){h()}),a(window).bind("showMap",function(a,b){f(b)}),d(),a(".media-viewer").trigger("media_init")}var h=function(){require(["eu_carousel"],function(b){var c=a(".js-mlt"),d=[];reg=/(?:\(['|"]?)(.*?)(?:['|"]?\))/,c.find("a.link").each(function(b,c){c=a(c),d[d.length]={thumb:reg.exec(c.closest(".mlt-img-div").css("background-image"))[1],title:c.closest(".mlt-img-div").next(".mlt-title").find("a")[0].innerHTML,link:c.attr("href"),linkTarget:"_self"}}),new b(c,d)})};g()});