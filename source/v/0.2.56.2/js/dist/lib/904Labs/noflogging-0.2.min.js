!function(a,b){function c(a,b){var c=document.createElement("script");c.type="text/javascript",c.async=!0,c.src=a;var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d),c.addEventListener?c.addEventListener("load",b,!1):c.attachEvent("onreadystatechange",function(){/complete|loaded/.test(c.readyState)&&b()})}function d(a,b){if(w[a]){s.debug&&console.log("Triggering event "+a);for(var c=0;c<w[a].length;c++)w[a][c](b)}}function e(a){s.log_browser_close&&p("browser_close",null),q(!1)}function f(a){s.debug&&console.log("handleMouseMove");var b=(new Date).getTime();if(b-v.last_sampled>=s.maximal_mouse_sample_freq_ms&&(v.position_x!=a.pageX||v.position_y!=a.pageY)){var c={timestamp:o(),mouse_position:{x:a.pageX,y:a.pageY},viewport_dimensions:m()};v.moves_buffer.push(c),d("mouse_move",c),v.position_x=a.pageX,v.position_y=a.pageY,v.last_sampled=b}}function g(){if(s.debug&&console.log("emptyMouseMovesBuffer"),v.moves_buffer.length>0){var a=v.moves_buffer.slice();v.moves_buffer.length=0,p("mouse_movements",a)}}function h(a){s.debug&&console.log("handleMouseClick");var b={mouse_position:{x:a.pageX,y:a.pageY},node_name:a.target.nodeName};a.target.id&&(b.node_id=a.target.id),a.target.className&&("SVGAnimatedString"===a.target.className.constructor.name?b.node_classes=a.target.className.baseVal.split(" "):b.node_classes=a.target.className.split(" ")),a.target.src&&(b.node_src=a.target.src),a.target.href&&(b.node_href=a.target.href),b.node_data_attrs={};var c=r.$(a.target).data();r.$.isEmptyObject(c)||r.$.each(c,function(a,c){"noflogging"==a.slice(0,11)&&(a=a.slice(11,a.length).toLowerCase(),b.node_data_attrs[a]=c)}),p("mouse_click",b),d("mouse_click",b)}function i(){return s.debug&&console.log("setVisitorCookie"),t.visitor_key||(t.visitor_key=j()),Cookies.set(s.project_key,r.getState(),{expires:3650}),!0}function j(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})}function k(){s.debug&&console.log("getVisitorCookie");var a=Cookies.get(s.project_key);return a!==b?(r.setState(a),!0):!1}function l(){return s.debug&&console.log("getScreenResolution"),{width:screen.width,height:screen.height}}function m(){return s.debug&&console.log("getViewportDimensions"),{width:r.$(a).width(),height:r.$(a).height()}}function n(){return s.debug&&console.log("getBrowserDimensions"),{width:r.$(document).width(),height:r.$(document).height()}}function o(){return r.moment().format("YYYY-MM-DDTHH:mm:ss.SSSZ")}function p(b,c){s.log_current_location&&(t.current_location=a.location.href),s.log_screen_resolution&&(t.screen_resolution=l()),s.log_viewport_dimensions&&(t.viewport_dimensions=m()),s.log_browser_dimensions&&(t.browser_dimensions=n());var d={};r.$.extend(d,t),i();var e={created_at:o(),state:d,event_type:b,event_properties:c};u.push(e)}function q(a){if(s.debug&&console.log("postEvents"),"undefined"===a&&(a=!0),0!==u.length){var b=u.slice();u.length=0,d("submit_events_queue",b),r.$.ajax({type:"POST",url:s.api_url+"/api/v0/bulklog",dataType:"json",beforeSend:function(a){a.setRequestHeader("Authorization","Basic "+r.base64encode(s.project_key+":"))},data:JSON.stringify(b),async:a,timeout:5e3,success:function(a){d("submit_events_response",a)},error:function(){u.push.apply(u,b)}})}}var r={},s={},t={},u=[],v={},w={};if(a.NOFLogging)return void console.log("return - already have a window.NOFlogging object");if(r.subscribe=function(a,b){s.dubg&&console.log("Registered listner on event "+a),"undefined"==typeof w[a]&&(w[a]=[]),w[a].push(b)},r.unsubscribe=function(a,b){if(w[a]){s.debug&&console.log("Unlistening on event "+a);for(var c=0;c<w[a].length;c++)if(w[a][c]===b){w[a].splice(c,1);break}}},r.init=function(b,f){if(!("api_url"in b))throw"Missing option: api_url";if(s.api_url=b.api_url,!("project_key"in b))throw"Missing option: project_key";s.project_key=b.project_key,s.use_visitor_cookie=b.user_visitor_cookie||!0,s.log_current_location=b.log_current_location||!0,s.log_screen_resolution=b.log_screen_resolution||!0,s.log_viewport_dimensions=b.log_viewport_dimensions||!0,s.log_browser_dimensions=b.log_browser_dimensions||!0,s.log_mouse_movements=b.log_mouse_movements||!1,s.maximal_mouse_sample_freq_ms=b.maximal_mouse_sample_freq_ms||40,s.mouse_movements_event_interval_ms=b.mouse_movements_event_interval_ms||1e3,s.log_mouse_clicks=b.log_mouse_clicks||!1,s.log_browser_close=b.log_browser_close||!1,s.post_events_queue_on_browser_close=b.post_events_queue_on_browser_close||!0,s.post_events_queue_interval_ms=b.post_events_queue_interval_ms||2e3,s.debug=b.debug||!1,c("http://analytics.904labs.com/static/jssdk/libs.js",function(){if(r.$=r.jQuery=jQuery.noConflict(!0),r.jQuery.support.cors=!0,s.log_mouse_movements&&r.enableMouseMovementLogging(),s.log_mouse_clicks&&r.enableMouseClickLogging(),setInterval(r.$.proxy(q,this),s.post_events_queue_interval_ms),s.post_events_queue_on_browser_close&&(a.addEventListener?a.addEventListener("beforeunload",e):a.attachEvent&&a.attachEvent("beforeunload",e)),Cookies.json=!0,s.use_visitor_cookie){console.log("checking for cookie ...");var b=k();b||i()}"function"==typeof f&&f(),d("ready")})},r.enableMouseMovementLogging=function(){s.debug&&console.log("enableMouseMovementsLogging"),v={moves_buffer:[],position_x:0,position_y:0,last_sampled:(new Date).getTime()},r.$(document).bind("mousemove",r.$.proxy(f)),v.empty_moves_buffer_interval=setInterval(r.$.proxy(g),s.mouse_movements_event_interval_ms)},r.disableMouseMovementLogging=function(){s.debug&&console.log("disableMouseMovementsLogging"),r.$(document).unbind("mousemove",f),clearInterval(v.empty_moves_buffer_interval)},r.enableMouseClickLogging=function(){s.debug&&console.log("enableMouseClickLogging"),r.$(document).bind("click",r.$.proxy(h))},r.disableMouseClickLogging=function(){s.debug&&console.log("disableMouseClickLogging"),r.$(document).unbind("click",h)},r.query=function(a,b){s.debug&&console.log("query"),"query"in t||(t.query={}),t.query.query_string=a,b&&(t.query.query_properties=b),t.query.current_page&&(t.query.current_page=1),p("query",null)},r.queryResults=function(a,b,c,d){s.debug&&console.log("queryResults");var e={results:a};(b||0===b)&&(e.n_total_results=b),(c||0===c)&&(e.n_displayed_results=c),(d||0===d)&&(e.query_time_ms=d),p("query_results",e)},r.paginate=function(a,b){s.debug&&console.log("paginate");var c={to_page_n:a};b?c.from_page_n=b:t.query.current_page?c.from_page_n=t.query.current_page:c.from_page_n=1,t.query.current_page=a,p("paginate",c)},r.userLogin=function(a,b,c){s.debug&&console.log("userLogin"),t.user_id=a,c!==!1&&("object"!=typeof b?p("login",null):p("login",b))},r.userLogout=function(){p("logout",null),delete t.user_id},r.getState=function(){return s.debug&&console.log("getState"),console.log(t),r.$.extend({},t)},r.setState=function(a){s.debug&&console.log("setState"),console.log(a),t=a},r.logEvent=function(a,b,c){if("string"!=typeof a)throw"event_type must be a string";if(0===a.length)throw"event_type cannot be an empty string";if("object"!=typeof b&&null!==b)throw"event_properties can only be an object or null";"object"==typeof c&&(t=c),p(a,b)},a.NOFLogging=r,"object"==typeof a.NOFLogging_ready){console.log("process window.NOFLogging_ready "+a.NOFLogging_ready.length);for(var x=0;x<a.NOFLogging_ready.length;x++)"function"==typeof a.NOFLogging_ready[x]&&a.NOFLogging_ready[x]()}else console.log("no such object window.NOFLogging_ready ")}(this);