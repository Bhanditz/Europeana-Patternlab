define(["jquery","util_resize"],function(a){var b=function(b,c,d){var e=a(b),f=e.find(".ellipsis-inner"),g=[],h="...XXX",i=!1,j=c&&c.tail?c.tail:"...",k=!1,l="";c&&c.fixed&&(k=c.fixed);var m=function(){return"undefined"!=typeof f[0]?f[0].offsetHeight>e.height()+3:void 0},n=function(a){return f.html(l.substr(0,a)+h),!m()},o=function(a,b,c){var d=c,e=0,f=0;if(a>l.length)e=Math.max(1,b/2),f=a-e;else if(n(a)){if(1==b)return a;e=c?Math.max(1,b/2):b,f=a+e}else d=!0,e=c?Math.max(1,b/2):b,f=a-e;return o(f,e,d)},p=function(){if(!i){e=a(b),f=e.find(".ellipsis-inner"),fixedHTML=e.find(".fixed").html();var g=o(20,16,!1),h=l.substr(0,g);if(f.html(h+(g<l.length&&l.length>0?j:"")+(k?k:"")),k){var m=e.find(".fixed");m.css("position",c.fixed_pos?c.fixed_pos:"absolute"),m.css("right",c.fixed_right?c.fixed_right:"0px"),m.css("bottom",c.fixed_bottom?c.fixed_bottom:"0px"),l.length>g&&m.html(fixedHTML)}"undefined"!=typeof d?d(e):e.css("visibility","visible")}},q=function(){if(0==f.length){var b=e.html();e.html(""),f=a('<div class="ellipsis-inner"></div>').appendTo(e),f.append(b)}var c=f.html();c=a.trim(c),l=c;for(var d=0;d<c.length;d++)g[d]=c.substr(d,1);p(),a(window).europeanaResize(function(){p()})};return q(),{getText:function(){return l},disable:function(){i=!0,f.html(l+(k?k:""))},enable:function(){i=!1,p()}}};return{create:function(a,c){var d=[];return a.each(function(){d.push(new b(this,c))}),d}}});