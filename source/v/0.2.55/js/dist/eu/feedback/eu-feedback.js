define(["jquery"],function(a){a("head").append('<link rel="stylesheet" href="'+require.toUrl("../../eu/feedback/style.css")+'" type="text/css"/>');var b=function(b,c){var d=b.find(".feedback-toggle .open"),e=b.find(".feedback-toggle .close"),f=b.find(".feedback-cancel"),g=b.find(".feedback-counter"),h=b.find(".feedback-spinner"),i=b.find(".feedback-send"),j=b.find(".feedback-text"),k=0;c=c?c:{},d.on("click",function(){b.addClass("open")}),e.on("click",function(){b.removeClass("open"),n(b.find(".step1"),200),m(b.find(".step2"),200),m(b.find(".feedback-error"),200)}),f.on("click",function(){b.removeClass("open"),n(b.find(".step1"),200),m(b.find(".step2"),200),m(b.find(".feedback-error"),200)});var l=function(b,c,d){b.delay(d).queue(function(b){a(this).css(c),b()})},m=function(a,b){l(a,{visibility:"hidden"},b)},n=function(a,b){l(a,{visibility:"visible"},b)};i.on("click",function(){if(0==j.val().length)return j.addClass("error"),void g.addClass("error");h.show();var d=b.find("form").attr("action"),e={type:b.find("input[name=type]:checked").val(),text:j.val(),page:window.location.href};c.beforeSend?c.beforeSend:null;a.ajax({beforeSend:c.beforeSend?c.beforeSend:null,url:d,type:"POST",data:e,success:function(a){h.hide(),m(b.find(".step1")),n(b.find(".step2")),j.val(""),g.html(k)},error:function(a){setTimeout(function(){n(b.find(".feedback-error")),m(b.find(".step1")),h.hide()},200)}})}),b.find(".pageurl").val(window.location.href),k=parseInt(g.data("maxlength")),g.html(k-j.val().length),j.on("keyup",function(){g.html(k-j.val().length),j.removeClass("error"),g.removeClass("error")}),b.fadeIn(function(){b.addClass("loaded")})};return{init:function(a,c){new b(a,c)}}});