define(["jquery","util_resize","purl"],function(a){function b(a){console.log("Virtual-Exhibitions: "+a)}function c(){m.param("show-sections")&&a(".ve-slide").css("border","2px dotted red"),e(),k(),f(),j(),h(),g(),d(),i(),a(window).europeanaResize(function(){a(window).width()<n?l&&a.each(o,function(a,b){b.enabled(!1)}):l?a.each(o,function(a,b){b.enabled(!0)}):(k(),f())})}function d(){a(".ve-base-embed iframe").each(function(c,d){d=a(d);var e=d.attr("height"),f=d.attr("width");"100%"==f&&(f="75%"),b("got video "+d.attr("src")+", w = "+f+", h = "+e),d.css("width",f?f:"auto"),d.css("height",e?e:"auto")})}function e(){require(["smartmenus"],function(){require(["smartmenus_keyboard"],function(){a(".nav_primary>ul").smartmenus({mainMenuSubOffsetX:-1,mainMenuSubOffsetY:4,subMenusSubOffsetX:6,subMenusSubOffsetY:-6,subMenusMaxWidth:null,subMenusMinWidth:null}),a("#settings-menu").smartmenus({mainMenuSubOffsetX:-62,mainMenuSubOffsetY:4,subMenusSubOffsetX:0,subMenusSubOffsetY:-6,subMenusMaxWidth:null,subMenusMinWidth:null}),a(".js-hack-smartmenu a").click(function(){var b=a(this).attr("href");"#"!=b&&(window.location=a(this).attr("href"))}),a(".nav_primary>ul").smartmenus("keyboardSetHotkey","123","shiftKey"),a("#settings-menu").smartmenus("keyboardSetHotkey","123","shiftKey")})})}function f(){if(a(window).width()<n)return void b("too small for scroll-magic");var c=a(".ve-slide.first");return 0==c.find("> .ve-base-intro:not(.ve-base-foyer-main)").size()?void b("first slide is not an intro"):void require(["ScrollMagic","TweenMax","jqScrollto"],function(a){require(["gsap"],function(){var b=".ve-base-intro-texts .ve-title-group, .ve-base-intro-texts .ve-description, .ve-base-intro-texts .ve-image-credit";o.push(new a.Scene({triggerElement:c,triggerHook:"onLeave",duration:p}).setTween(TweenMax.to(c.find(b),1,{opacity:0,ease:Cubic.easeOut})).addTo(l)),o.push(new a.Scene({triggerElement:c,triggerHook:"onLeave",duration:p}).setPin(c[0]).setTween(TweenMax.to(c.find(".ve-base-intro"),1.25,{delay:.25,width:"75%",ease:Cubic.easeOut,minHeight:"60vh"})).addTo(l)),o.push(new a.Scene({triggerElement:c,triggerHook:"onLeave",duration:2*p}).setTween(TweenMax.fromTo(c.find(".ve-intro-full-description"),1,{css:{opacity:0,ease:Cubic.easeOut}},{css:{opacity:1,ease:Cubic.easeOut}})).addTo(l))})})}function g(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1?void a(".ve-anchor").not(":first").css("top",0-a(".header").height()):void 0}function h(){a(".slide-nav-next").not(":first").hide(),a(".slide-nav-next:first").css("position","fixed"),a(".slide-nav-next:first").on("click",function(b){if(l){var c=a(".ve-progress-nav .ve-state-button-on").parent(),d=c.next("a"),e=d.attr("href");a(window).scrollTo(e,q),b.preventDefault()}})}function i(){var b=[],c=a(".ve-foyer-card-state .text-box.description:not(.js-ellipsis)"),d=[];c.each(function(){a(this).addClass("js-ellipsis"),d.push(a(this))}),d.length>0&&require(["util_ellipsis"],function(c){for(var e=c.create(a(d)),f=0;f<e.length;f++)b.push(e[f])})}function j(){function b(a){var b=this;b.stateIndex=0,b.cardStates=a.find(".ve-foyer-card-state"),b.label=a.find(".ve-label"),b.$el=a,a.find(".ve-card-nav-left").on("click",function(){b.left()}),a.find(".ve-card-nav-right").on("click",function(){b.right()}),this.prepNextShift()}b.prototype.updateButton=function(a){this.$el.find(".ve-state-button-on").removeClass("ve-state-button-on").addClass("ve-state-button-off"),this.$el.find(".ve-state-"+a).removeClass("ve-state-button-off").addClass("ve-state-button-on")},b.prototype.prepNextShift=function(b){var c=this.stateIndex==this.states.length-1?0:this.stateIndex+1,d=0==this.stateIndex?this.states.length-1:this.stateIndex-1;c=a(this.cardStates.get(c)),d=a(this.cardStates.get(d)),c.hasClass("hide-left")&&(c.removeClass("animating"),c.removeClass("hide-left"),c.addClass("hide-right")),d.hasClass("hide-right")&&(d.removeClass("animating"),d.removeClass("hide-right"),d.addClass("hide-left"))},b.prototype.shiftState=function(b){var c=a(this.cardStates.get(this.stateIndex));c.addClass("animating"),c.addClass(b>0?"hide-left":"hide-right");var d=this.stateIndex+b;d==this.states.length?d=0:0>d&&(d=this.states.length-1),this.stateIndex=d,0==this.stateIndex?this.label.show():this.label.hide();var e=a(this.cardStates.get(this.stateIndex));e.removeClass("animating"),b>0?(e.addClass("hide-right"),e.removeClass("hide-left"),e.addClass("animating"),e.removeClass("hide-right")):(e.addClass("hide-left"),e.removeClass("hide-right"),e.addClass("animating"),e.removeClass("hide-left")),this.prepNextShift(),this.updateButton(this.stateIndex)},b.prototype.left=function(){this.shiftState(-1)},b.prototype.right=function(){this.shiftState(1)},b.prototype.states=["title","description","credits"],a(".ve-foyer-card").each(function(){new b(a(this))})}function k(){return a(window).width()<n?void b("too small for scroll-magic"):void require(["ScrollMagic","TweenMax","jqScrollto"],function(c){require(["gsap"],function(){function d(b){a(".ve-progress-nav .ve-state-button-on").removeClass("ve-state-button-on").addClass("ve-state-button-off");var c=a(".ve-progress-nav .ve-state-button").get(b);a(c).addClass("ve-state-button-on").removeClass("ve-state-button-off")}l=new c.Controller,a(".ve-slide-container section").each(function(a,b){new c.Scene({triggerElement:this,triggerHook:"onCenter"}).on("progress",function(b){"FORWARD"===b.scrollDirection&&d(a)}).addTo(l),new c.Scene({triggerElement:this,triggerHook:"onLeave"}).on("progress",function(b){"REVERSE"===b.scrollDirection&&d(a)}).addTo(l)}),new c.Scene({triggerElement:"#ve-end",triggerHook:"onEnter"}).addTo(l).setTween(TweenMax.to(".ve-progress-nav",1,{right:"-1em",ease:Cubic.easeOut})),a(".ve-progress-nav a").on("click",function(c){c.preventDefault();var d=a(this).attr("href");d=a(d),b("current scroll offset: "+window.scrollY),a(".ve-progress-nav a:first .ve-state-button").hasClass("ve-state-button-on")?a(window).scrollTo(d.parent(),q,{axis:"y",easing:"linear",offset:-200,onAfter:function(){a(window).scrollTo(d,q)}}):a(window).scrollTo(d,q)})})})}var l,m=a.url(),n=768,o=[],p=500,q=1400;return{initPage:function(){c()}}});