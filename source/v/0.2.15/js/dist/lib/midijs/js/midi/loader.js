"undefined"==typeof MIDI&&(MIDI={}),MIDI.Soundfont=MIDI.Soundfont||{},MIDI.Player=MIDI.Player||{},function(a){"use strict";a.DEBUG=!0,a.USE_XHR=!0,a.soundfontUrl="./soundfont/",a.loadPlugin=function(c){"function"==typeof c&&(c={onsuccess:c}),a.soundfontUrl=c.soundfontUrl||a.soundfontUrl,a.audioDetect(function(d){var e=window.location.hash,f="";if(d[c.api]?f=c.api:d[e.substr(1)]?f=e.substr(1):d.webmidi?f="webmidi":window.AudioContext?f="webaudio":window.Audio&&(f="audiotag"),b[f]){if(c.targetFormat)var g=c.targetFormat;else var g=d["audio/ogg"]?"ogg":"mp3";a.__api=f,a.__audioFormat=g,a.supports=d,a.loadResource(c)}})},a.loadResource=function(c){var d=c.instruments||c.instrument||"acoustic_grand_piano";"object"!=typeof d&&(d=d||0===d?[d]:[]);for(var e=0;e<d.length;e++){var f=d[e];f===+f&&a.GM.byId[f]&&(d[e]=a.GM.byId[f].id)}c.format=a.__audioFormat,c.instruments=d,b[a.__api](c)};var b={webmidi:function(b){a.WebMIDI.connect(b)},audiotag:function(a){c(a,"AudioTag")},webaudio:function(a){c(a,"WebAudio")}},c=function(b,c){for(var e=b.format,f=b.instruments,g=b.onprogress,h=b.onerror,i=f.length,j=i,k=function(){--j||(g&&g("load",1),a[c].connect(b))},l=0;i>l;l++){var m=f[l];MIDI.Soundfont[m]?k():d(f[l],e,function(a,b){var c=b/i,d=(i-j)/i;g&&g("load",c+d,m)},function(){k()},h)}},d=function(b,c,d,e,f){var g=a.soundfontUrl+b+"-"+c+".js";a.USE_XHR?a.util.request({url:g,format:"text",onerror:f,onprogress:d,onsuccess:function(a,b){var c=document.createElement("script");c.language="javascript",c.type="text/javascript",c.text=b,document.body.appendChild(c),e()}}):dom.loadScript.add({url:g,verify:'MIDI.Soundfont["'+b+'"]',onerror:f,onsuccess:function(){e()}})};a.setDefaultPlugin=function(b){for(var c in b)a[c]=b[c]}}(MIDI);