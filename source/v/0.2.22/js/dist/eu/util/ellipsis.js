define(["jquery","util_resize"],function(a){var b=function(b,c,d){var e=a(b),f=e.find(".ellipsis-inner"),g=[],h="... XXX",i=c&&c.tail?c.tail:"...&nbsp;&nbsp;",j=!1,k="";c&&c.fixed&&(j=c.fixed);var l=function(){return"undefined"!=typeof f[0]?f[0].offsetHeight>e.height()+3:void 0},m=function(a){return f.html(k.substr(0,a)+h),!l()},n=function(a,b,c){var d=c,e=0,f=0;if(a>k.length)e=Math.max(1,b/2),f=a-e;else if(m(a)){if(1==b)return a;e=c?Math.max(1,b/2):b,f=a+e}else d=!0,e=c?Math.max(1,b/2):b,f=a-e;return n(f,e,d)},o=function(){e=a(b),f=e.find(".ellipsis-inner"),fixedHTML=e.find(".fixed").html();var g=n(20,16,!1),h=k.substr(0,g);if(f.html(h+(g<k.length&&k.length>0?i:"")+(j?j:"")),j){var l=e.find(".fixed");l.css("position",c.fixed_pos?c.fixed_pos:"absolute"),l.css("right",c.fixed_right?c.fixed_right:"0px"),l.css("bottom",c.fixed_bottom?c.fixed_bottom:"0px"),k.length>g&&l.html(fixedHTML)}"undefined"!=typeof d?d(e):e.css("visibility","visible")},p=function(){if(0==f.length){var b=e.html();e.html(""),f=a('<div class="ellipsis-inner"></div>').appendTo(e),f.append(b)}var c=f.html();c=a.trim(c),k=c;for(var d=0;d<c.length;d++)g[d]=c.substr(d,1);o(),a(window).europeanaResize(function(){o()})};p()};return{create:function(a,c){var d=[];return a.each(function(){d.push(new b(this,c))}),d}}});