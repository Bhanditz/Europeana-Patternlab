if("undefined"==typeof MIDI)var MIDI={};"undefined"==typeof MIDI.Plugin&&(MIDI.Plugin={}),function(){"use strict";"undefined"==typeof MIDI.WebAudioAPI&&(MIDI.WebAudioAPI={}),(window.AudioContext||window.webkitAudioContext)&&function(){var a,b=window.AudioContext||window.webkitAudioContext,c=MIDI.WebAudioAPI,d={},e=1,f={},g=function(b,c,d,e){var g=b[c],h=MIDI.Soundfont[g].split(",")[1],i=Base64Binary.decodeArrayBuffer(h);a.decodeAudioData(i,function(a){for(var h=g;h.length<3;)h+="&nbsp;";if("undefined"!=typeof loader&&"undefined"!=typeof loader.message&&loader.message("Downloading: 100%<br>Processing: "+(c/87*100>>0)+"%<br>"+h),a.id=g,d[c]=a,d.length===b.length){for(;d.length;){a=d.pop();var i=MIDI.keyToNote[a.id];f[i]=a}e()}})};c.setVolume=function(a){console.log("root.setVolume("+a+") prev vol was "+e),e=a},c.programChange=function(a){},c.noteOn=function(b,c,g,h){if(f[c]){h<a.currentTime&&(h+=a.currentTime);var i=a.createBufferSource();d[b+""+c]=i,i.buffer=f[c],i.connect(a.destination);var j;j="undefined"==typeof a.createGain?a.createGainNode():a.createGain();var k=-.5+g/100*2,l=2*(1-e);return j.gain.value=Math.max(-1,k-l),j.connect(a.destination),i.connect(j),"undefined"!=typeof i.noteOn&&i.noteOn(h||0),i.start(h||0),i}},c.chordOn=function(a,b,d,e){for(var f,g={},h=0,i=b.length;i>h;h++)g[f=b[h]]=c.noteOn(a,f,d,e);return g},c.noteOff=function(a,b,c){},c.chordOff=function(a,b,c){},c.connect=function(d){MIDI.lang="WebAudioAPI",MIDI.setVolume=c.setVolume,MIDI.programChange=c.programChange,MIDI.noteOn=c.noteOn,MIDI.noteOff=c.noteOff,MIDI.chordOn=c.chordOn,MIDI.chordOff=c.chordOff,MIDI.Player.ctx=a=new b;var e=[],f=MIDI.keyToNote;for(var h in f)e.push(h);for(var i=[],j=0;j<e.length;j++)g(e,j,i,d)}}(),window.Audio&&function(){for(var a=MIDI.HTML5={},b={},c=1,d=-1,e={},f=[],g={},h=0;12>h;h++)f[h]=new Audio;var i=function(a){var b=g[a];if(b){var h=(d+1)%f.length,i=((new Date).getTime(),f[h]);e[b.id]=i,i.src=MIDI.Soundfont[b.id],i.volume=c,i.play(),d=h}};a.programChange=function(){},a.setVolume=function(a){c=a},a.noteOn=function(a,c,d,e){var f=b[c];if(g[f]){if(e){var h=window.setTimeout(function(){i(f)},1e3*e);return h}i(f)}},a.noteOff=function(a,b,c){},a.chordOn=function(a,c,d,e){for(var f in c){var h=c[f],j=b[h];g[j]&&i(j)}},a.chordOff=function(a,b,c){},a.stopAllNotes=function(){for(var a=0,b=f.length;b>a;a++)f[a].pause()},a.connect=function(c){for(var d in MIDI.keyToNote)b[MIDI.keyToNote[d]]=d,g[d]={id:d};MIDI.lang="HTML5",MIDI.setVolume=a.setVolume,MIDI.programChange=a.programChange,MIDI.noteOn=a.noteOn,MIDI.noteOff=a.noteOff,MIDI.chordOn=a.chordOn,MIDI.chordOff=a.chordOff,c&&c()}}(),function(){var a=MIDI.Flash={},b={},c={};a.programChange=function(){},a.setVolume=function(a,b){},a.noteOn=function(a,d,e,f){var g=b[d];if(c[g]){if(f){var h=window.setTimeout(function(){c[g].play({volume:2*e})},1e3*f);return h}c[g].play({volume:2*e})}},a.noteOff=function(a,b,c){},a.chordOn=function(a,d,e,f){for(var g in d){var h=d[g],i=b[h];c[i]&&c[i].play({volume:2*e})}},a.chordOff=function(a,b,c){},a.stopAllNotes=function(){},a.connect=function(d){soundManager.flashVersion=9,soundManager.useHTML5Audio=!0,soundManager.url="../../swf/",soundManager.useHighPerformance=!0,soundManager.wmode="transparent",soundManager.flashPollingInterval=1,soundManager.debugMode=!1,soundManager.onload=function(){for(var e=[],f=function(){e.push(this.sID),"undefined"!=typeof loader&&loader.message("Processing: "+this.sID)},g=10;75>g;g++){var h=b[g+26];c[h]=soundManager.createSound({id:h,url:"./soundfont/mp3/"+h+".mp3",multiShot:!0,autoLoad:!0,onload:f})}MIDI.lang="Flash",MIDI.setVolume=a.setVolume,MIDI.programChange=a.programChange,MIDI.noteOn=a.noteOn,MIDI.noteOff=a.noteOff,MIDI.chordOn=a.chordOn,MIDI.chordOff=a.chordOff;var i=window.setInterval(function(){65===e.length&&(window.clearInterval(i),d&&d())},25)},soundManager.onerror=function(){};for(var e in MIDI.keyToNote)b[MIDI.keyToNote[e]]=e}}(),function(){var a=MIDI.Java={};a.connect=function(a){if(MIDI.Plugin=!1,!window.navigator.javaEnabled())return void MIDI.Flash.connect(a);MIDI.Java.callback=a;var b=document.createElement("iframe");b.name="MIDIFrame",b.src="inc/midibridge/index.html",b.width=1,b.height=1,document.body.appendChild(b)},a.confirm=function(a){MIDI.programChange=function(b){a.sendMidiEvent(192,0,b,0)},MIDI.setVolume=function(a){},MIDI.noteOn=function(b,c,d,e){if(e){var f=window.setTimeout(function(){a.sendMidiEvent(144,b,c,d)},1e3*e);return f}a.sendMidiEvent(144,b,c,d)},MIDI.noteOff=function(b,c,d){if(d){var e=window.setTimeout(function(){a.sendMidiEvent(128,b,c,0)},1e3*d);return e}a.sendMidiEvent(128,b,c,0)},MIDI.chordOn=function(b,c,d,e){for(var f in c){var g=c[f];a.sendMidiEvent(144,b,g,100)}},MIDI.chordOff=function(b,c,d){for(var e in c){var f=c[e];a.sendMidiEvent(128,b,f,100)}},MIDI.stopAllNotes=function(){},MIDI.getInstruments=function(){return[]},a.ready?(MIDI.lang="Java",MIDI.Java.callback&&MIDI.Java.callback()):MIDI.Flash.connect(MIDI.Java.callback)}}(),MIDI.instruments=function(a){var b={};for(var c in a)for(var d=a[c],e=0,f=d.length;f>e;e++){var g=d[e];if(g){var h=parseInt(g.substr(0,g.indexOf(" ")),10);g=g.replace(h+" ",""),b[--h]={instrument:g,category:c},b[g]={number:h,category:c}}}return b}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),MIDI.channels=function(){for(var a={},b=0;16>b;b++)a[b]={instrument:0,mute:!1,mono:!1,omni:!1,solo:!1};return a}(),MIDI.keyToNote={},MIDI.noteToKey={},function(){for(var a=21,b=108,c=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],d=a;b>=d;d++){var e=(d-12)/12>>0,f=c[d%12]+e;MIDI.keyToNote[f]=d,MIDI.noteToKey[d]=f}}()}(),MIDI.pianoKeyOffset=21;