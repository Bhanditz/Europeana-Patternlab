var keyToNote={},noteToKey={};!function(){for(var a=21,b=108,c=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],d=a;b>=d;d++){var e=(d-12)/12>>0,f=c[d%12]+e;keyToNote[f]=d,noteToKey[d]=f}}();var zlib=require("zlib"),fs=require("fs"),beautify=require("js-beautify").js_beautify,exec=require("child_process").exec,walk=require("walk"),walker=walk.walk("./source",{followLinks:!1}),buildDir="./build/",instrumentName="synth_drum",instrumentDir=buildDir+instrumentName+"/",index=21,output={};output.ogg=[],output.mp3=[],walker.on("file",function(a,b,c){return-1===b.name.indexOf(".wav")?c():void convertPackage(b,"mp3",function(){convertPackage(b,"ogg",function(){return index++,c()})})}),walker.on("end",function(){writePackage("mp3"),writePackage("ogg")});var encoder={mp3:"lame -v -b 8 -B 64",ogg:"oggenc -m 32 -M 128"},convertPackage=function(a,b,c){var d="./source/"+a.name;exec(encoder[b]+" '"+d+"'",function(e){var f=d.replace(".wav","."+b);fs.readFile(f,function(d,e){var g=noteToKey[index];if("mp3"===b){var h=f,i=instrumentDir+g+".mp3";fs.existsSync(instrumentDir)||fs.mkdirSync(instrumentDir),exec("mv '"+h+"' '"+i+"'",function(a){console.log(a,h,i)})}return output[b].push({name:a.name,key:noteToKey[index],data:"data:audio/"+b+";base64,"+e.toString("base64")}),c()})})},writePackage=function(a){for(var b=output[a],c='if (typeof(MIDI) === "undefined") var MIDI = {};if (typeof(MIDI.Soundfont) === "undefined") MIDI.Soundfont = {};MIDI.Soundfont["'+instrumentName+'"] = ',d={},e=0;e<b.length;e++){var f=b[e];d[f.key]=f.data}var g=beautify(c+JSON.stringify(d)),h="./build/"+instrumentName+"."+a+".js";fs.writeFileSync(h,g);var i=new Buffer(g,"utf-8");zlib.gzip(i,function(a,b){fs.writeFileSync(h+".gz",b)})};