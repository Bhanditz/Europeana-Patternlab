define(["jquery"],function(a){function b(a){console.log(a)}function c(a,c,d){this.history={},this.direction="d",this.jump=d?d:4,this.val=a,this.initialVal=a,this.tries=0,this.test=c?c:function(a){return b("default optimise test"),11>=a},this.max_while_break=10}function d(a,b,c){this.selCmpArray=a,this.selText=b,this.selTweak=c,this.minFs=100,this.members=[],this.styleIds={base:"wrap-nice-base",test:"wrap-nice-test",real:"wrap-nice-style",fs:"wrap-nice-fs"},this.styles={$base:null,$test:null,$real:null,$fs:null},this.css={wwn:"word-wrap:normal;",oa:"overflow:auto;"},this.init()}function e(a,b){this.$cmp=a,this.$txt=a.find(b.selText),this.$twk=a.find(b.selTweak),this.parent=b,this.fs=null,this.init()}function f(){if(window.location.href.indexOf("wrapnice")>-1){var b=".home-promo > li",c=".promo-block > a",e="span.title";wrapNiceGroup=new d(b,c,e),a(window).europeanaResize(function(){wrapNiceGroup.resize()})}}c.prototype={constructor:c,find:function(){for(var a=this,b=a.getNext(a.val),c=0;!(b.isFinal||(b=a.getNext(b.val),c++,c>a.max_while_break)););return b.val},halfJump:function(){var a=this;a.jump>1&&(a.jump=Math.max(1,Math.floor(a.jump/2)))},getNext:function(a){var c=this,d=null;if(a="d"==c.direction?a-c.jump:a+c.jump,"undefined"==typeof c.history[""+a]?(d=c.test(a),c.history[""+a]=d):d=c.history[""+a],d){if(1==c.jump)return{val:a,isFinal:!0};"d"==c.direction&&(c.direction="u",c.halfJump())}else"u"==c.direction&&(c.direction="d",c.halfJump());return b("getNext val = "+a+", testRes = "+d+", jump = "+(1==c.jump)+" ("+c.jump+")"),{val:a,isFinal:d&&1==c.jump}}},d.prototype={constructor:d,init:function(){var b=this;a(b.selCmpArray).each(function(){b.members.push(new e(a(this),b))}),b.styleToSmallestFs()},set_text:function(a,b){a.empty(),a[0].appendChild(document.createTextNode(b))},get_style_tag:function(b){return a('<style id="'+b+'" type="text/css"></style>').appendTo("head")},get_style_tag_text:function(a){for(var b="",c=0;c<a.length;c++){b+=a[c].sel+"{\n";for(var d=0;d<a[c].rules.length;d++)b+=a[c].rules[d]+"\n";b+="}\n"}return b},enable_stylesheet:function(a){var c=this;if(b("ENABLE "+(a?a.attr("id"):"")+" ???"),a)if(a.text().indexOf("/*")>-1){var d=a.text().replace("/*","").replace("*/","");c.set_text(a,d)}else b("ALREADY ENABLED");else b("ENABLE WHAT ???")},disable_stylesheet:function(a){var c=this;b("DISABLE "+(a?a.attr("id"):"")+" ???"),a?-1==a.text().indexOf("/*")?c.set_text(a,"/*"+a.text()+"*/"):b("ALREADY DISABLED "+a.attr("id")):b("DISABLE WHAT ???")},styleToSmallestFs:function(){var a=this,b=a.minFs;a.test_start();for(var c=0;c<a.members.length;c++)a.members[c].tryFit(),b=a.members[c].fs?Math.min(a.members[c].fs,b):b;if(a.test_end(),b<a.minFs){var d="font-size:"+b+"px;",e=[{sel:a.selCmpArray+" "+a.selTweak,rules:[a.css.wwn,d]}],f=a.get_style_tag_text(e);a.styles.$real||(a.styles.$real=a.get_style_tag(a.styleIds.real)),a.set_text(a.styles.$real,f)}},test_start:function(){var a=this;if(a.history={},a.styles.$test)a.enable_stylesheet(a.styles.$test);else{var b=a.get_style_tag_text([{sel:a.selCmpArray,rules:[a.css.wwn]}]),c=a.get_style_tag_text([{sel:a.selCmpArray+" "+a.selText,rules:[a.css.oa]}]);a.styles.$base=a.get_style_tag(a.styleIds.base),a.styles.$test=a.get_style_tag(a.styleIds.test),a.set_text(a.styles.$base,b),a.set_text(a.styles.$test,c)}},apply_fs:function(c){var d=this;if(!c)return void d.disable_stylesheet(d.styles.$fs);var e="font-size:"+c+"px;",f=[{sel:d.selCmpArray+" "+d.selTweak,rules:[e]}],g=d.get_style_tag_text(f);d.styles.$fs||(d.styles.$fs=d.get_style_tag(d.styleIds.fs)),d.set_text(d.styles.$fs,g),b("apply("+c+"),  test stylesheet = "+a("#"+d.styleIds.test).length)},test_end:function(){var a=this;b("test_end: disable test.."),a.disable_stylesheet(a.styles.$test)},resize:function(){var a=this;b("resize, disable real..."),a.disable_stylesheet(a.styles.$real),a.styleToSmallestFs()}},e.prototype={constructor:e,init:function(){var a=this;a.tryFit()},tryFit:function(){var a=this,b=function(){return a.$txt.width()==a.$txt[0].scrollWidth};b()||(a.fs=new c(parseInt(a.$twk.css("font-size"))-1,function(c){return a.parent.apply_fs(c),b()},5).find(),a.parent.apply_fs())}},"undefined"!=typeof f&&f()});