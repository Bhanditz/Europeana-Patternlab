define(["jquery","search_form","smartmenus"],function(){function a(a){console.log("Mosaic: "+a)}function b(b,c){require(["imagesloaded"],function(){require(["photoswipe","photoswipe_ui"],function(d,e){$("body").append('<div id="img-measure" style="position:absolute; visibility:hidden;">');for(var f=0;f<b.length;f++)$("#img-measure").append('<img src="'+b[f]+'">');var g=[];$("#img-measure").imagesLoaded(function(b,f,h){a("measured");for(var i=0;i<b.length;i++){var j=$(b[i]);g.push({src:j.attr("src"),h:j.height(),w:j.width()})}$("#img-measure").remove();var k={index:c};lightboxOpen=!0;var l=new d($(".pswp")[0],e,g,k);l.listen("close",function(){setTimeout(function(){lightboxOpen=!1},500)}),setTimeout(function(){l.init(),a("opened")},100)})})})}function c(){var a=require.toUrl("../lib/photoswipe/photoswipe.css"),c=require.toUrl("../lib/photoswipe/default-skin/default-skin.css");$(".photoswipe-wrapper > img");$("head").append('<link rel="stylesheet" href="'+a+'" type="text/css"/>'),$("head").append('<link rel="stylesheet" href="'+c+'" type="text/css"/>'),$("head").append("<style>.pswp__button--share{ display: none; }</style>"),$(".mosaic-gallery-item").click(function(a){var c=$(a.target),d=[];$(".mosaic-gallery-item").each(function(){d.push($(this).attr("src"))}),b(d,d.indexOf(c.attr("src")))})}function d(){$.get(g,function(b){a("got board data:\n\n"+JSON.stringify(b)),$.each(b.names,function(a,b){$("#board").append($("<option>",{value:b,text:b}))})})}function e(){$("body").addClass("loading"),$("#result-link").html("");var b="heroes",c="4",d="60",b=$("#board").val(),c=$("#scale").val(),d=$("#size").val(),e=$(".mosaic-form").serialize(),e=new FormData($(".mosaic-form")[0]),f=h+b+"?scale="+c+"&size="+d;a(f),a(e),$.ajax({headers:{"Content-Type":void 0},url:f,type:"POST",data:e,processData:!1,contentType:!1,success:function(a){$("#result-link").html('<a href="'+a.link+'" target="_new">view result</a>'),$("body").removeClass("loading")}})}function f(){d(),$(".mosaic-gallery-item").each(function(a,b){a>2&&$(b).addClass("push-up")}),$("#target_image").on("change",function(){$("#file_name").val(this.value.replace("C:\\fakepath\\",""))}),$(".mosaic-form").on("submit",function(a){e(),a.preventDefault()}),c()}var g="http://chaos.eanadev.org/inspire/boards/europeana/",h="http://chaos.eanadev.org/inspire/mosaic/europeana/";f()});