!function(a){"use strict";window.AudioContext&&function(){function b(a,b,c){if(e){var f=new Audio;f.src=a,f.controls=!1,f.autoplay=!1,f.preload=!1,f.addEventListener("canplay",function(){b&&b(f)}),f.addEventListener("error",function(a){c&&c(a)}),document.body.appendChild(f)}else if(0===a.indexOf("data:audio")){var g=a.split(",")[1],h=Base64Binary.decodeArrayBuffer(g);d.decodeAudioData(h,b,c)}else{var i=new XMLHttpRequest;i.open("GET",a,!0),i.responseType="arraybuffer",i.onload=function(){d.decodeAudioData(i.response,b,c)},i.send()}}function c(){return new(window.AudioContext||window.webkitAudioContext)}var d,e=!1,f=a.WebAudio={api:"webaudio"},g={},h={},i=127,j={};f.audioBuffers=j,f.send=function(a,b){},f.setController=function(a,b,c,d){},f.setVolume=function(a,b,c){c?setTimeout(function(){i=b},1e3*c):i=b},f.programChange=function(b,c,d){var e=a.channels[b];e.instrument=c},f.pitchBend=function(b,c,d){var e=a.channels[b];e.pitchBend=c},f.noteOn=function(b,c,f,k){k=k||0;var l=a.channels[b],m=l.instrument,n=m+""+c,o=j[n];if(o){if(k<d.currentTime&&(k+=d.currentTime),e)var p=d.createMediaElementSource(o);else{var p=d.createBufferSource();p.buffer=o}if(h){var q=p;for(var r in h)q.connect(h[r].input),q=h[r]}var s=f/127*(i/127)*2-1;if(p.connect(d.destination),p.playbackRate.value=1,p.gainNode=d.createGain(),p.gainNode.connect(d.destination),p.gainNode.gain.value=Math.min(1,Math.max(-1,s)),p.connect(p.gainNode),e){if(k)return setTimeout(function(){o.currentTime=0,o.play()},1e3*k);o.currentTime=0,o.play()}else p.start(k||0);return g[b+""+c]=p,p}},f.noteOff=function(b,c,f){f=f||0;var h=a.channels[b],i=h.instrument,k=i+""+c,l=j[k];if(l){f<d.currentTime&&(f+=d.currentTime);var m=g[b+""+c];if(m){if(m.gainNode){var n=m.gainNode.gain;n.linearRampToValueAtTime(n.value,f),n.linearRampToValueAtTime(-1,f+.3)}return e?f?setTimeout(function(){l.pause()},1e3*f):l.pause():m.noteOff?m.noteOff(f+.5):m.stop(f+.5),delete g[b+""+c],m}}},f.chordOn=function(a,b,c,d){for(var e,g={},h=0,i=b.length;i>h;h++)g[e=b[h]]=f.noteOn(a,e,c,d);return g},f.chordOff=function(a,b,c){for(var d,e={},g=0,h=b.length;h>g;g++)e[d=b[g]]=f.noteOff(a,d,c);return e},f.stopAllNotes=function(){for(var a in g){var b=0;b<d.currentTime&&(b+=d.currentTime);var c=g[a];c.gain.linearRampToValueAtTime(1,b),c.gain.linearRampToValueAtTime(0,b+.3),c.noteOff?c.noteOff(b+.3):c.stop(b+.3),delete g[a]}},f.setEffects=function(a){if(!d.tunajs)return console.log("Effects module not installed.");for(var b=0;b<a.length;b++){var c=a[b],e=new d.tunajs[c.type](c);e.connect(d.destination),h[c.type]=e}},f.connect=function(b){a.setDefaultPlugin(f),f.setContext(d||c(),b.onsuccess)},f.getContext=function(){return d},f.setContext=function(c,e,f,g){d=c,"undefined"==typeof Tuna||d.tunajs||(d.tunajs=new Tuna(d));var h=[],i=a.keyToNote;for(var k in i)h.push(k);var l=function(a){for(var b in n)if(n[b])return;e&&(e(),e=null)},m=function(c,d,e,f){var g=c[f];g&&(n[d]++,b(g,function(b){b.id=f;var e=a.keyToNote[f];if(j[d+""+e]=b,0===--n[d]){c.isLoaded=!0,l(o)}},function(a){}))},n={};for(var o in a.Soundfont){var p=a.Soundfont[o];if(!p.isLoaded){var q=a.GM.byName[o],r=q.number;n[r]=0;for(var s=0;s<h.length;s++){var k=h[s];m(p,r,s,k)}}}setTimeout(l,1)}}()}(MIDI);