define(["jquery","util_scrollEvents","media_controller"],function(a,b){function c(a){console.log(a)}function d(b){var d=function(b,d,e){c("initLeaflet:\n	"+JSON.stringify(b)+"\n	"+JSON.stringify(d));var f="map",g="map-info",h=a("#map-place-name").text();require(["leaflet"],function(){a("#"+f).after('<div id="'+g+'"></div>');var c='Tiles &copy; <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" alt="mapquest logo"/>',i=new L.TileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/{type}/{z}/{x}/{y}.png",{minZoom:4,maxZoom:18,attribution:c,subdomains:"1234",type:"osm"}),j=L.map(f,{center:new L.LatLng(d[0],b[0]),zoomControl:!0,zoom:8});L.Icon.Default.imagePath=require.toUrl("../css/map/images"),j.addLayer(i),j.invalidateSize();for(var k=[],l=0;l<Math.min(d.length,b.length);l++)L.marker([d[l],b[l]]).addTo(j),k.push(d[l]+"&deg; "+(d[l]>0?e.n:e.s)+", "+b[l]+"&deg; "+(b[l]>0?e.e:e.w));h=h?h.toUpperCase()+" ":"",a("#"+g).html(h+(k.length?" "+k.join(", "):"")),a("head").append('<link rel="stylesheet" href="'+require.toUrl("../css/map/application-map.css")+'" type="text/css"/>')})},e=(b.latitude+"").split(/,*\s+/g),f=(b.longitude+"").split(/,*\s+/g);if(e&&f){for(var g=0;g<e.length;g++)e[g]=e[g].replace(/,/g,".").indexOf(".")>-1?e[g]:e[g]+".00";for(var g=0;g<f.length;g++)f[g]+f[g].replace(/,/g,".").indexOf(".")>-1?f[g]:f[g]+".00";for(var h=[],i=[],g=0;g<Math.min(e.length,f.length);g++)e[g]&&f[g]&&[e[g]+"",f[g]+""].join(",").match(/^\s*-?\d+\.\d+\,\s?-?\d+\.\d+\s*$/)?(h.push(f[g]),i.push(e[g])):c("Map data error: invalid coordinate pair:\n	"+h[g]+"\n	"+i[g]);h.length&&i.length?d(h,i,b.labels):c("Map data missing")}}function e(){i(),a(window).bind("showMLT",function(a,b){h(b)}),a(window).bind("showMediaThumbs",function(a,b){g(b)}),a(window).bind("showMap",function(a,b){d(b)}),a(".media-viewer").trigger("media_init"),b.fireAllVisible()}var f=function(a,b){var c=jQuery.Deferred();return require(["eu_carousel","eu_carousel_appender"],function(d,e){var f=e.create({cmp:a.find("ul"),loadUrl:b.loadUrl,template:b.template,total_available:b.total_available});c.resolve(d.create(a,f,b))}),c.promise()},g=function(b){if(a(".object-media-nav li").length>1){var d=f(a(".media-thumbs"),b);d.done(function(b){var d=function(c){if(c){var d=a(".media-thumbs").outerHeight(!0),e=d-a(".media-thumbs").height();a(".media-thumbs").removeAttr("style");var f=a(".media-viewer").height()-e;a(".media-thumbs").css("height",f+"px")}else a(".media-thumbs").removeAttr("style");b.resize()};b.vChange(function(a){d(a)}),a(".media-viewer").on("refresh-nav-carousel",function(){d(b.isVertical())});var e=function(b){c("updateTechData");var d=a(b.target),e={href:"",meta:[]},f=function(b,c){a(".file-info .file-title").attr("href",b),a(".file-info .file-meta li").remove(),a.each(c,function(b,c){a(".file-info .file-meta").append("<li>"+c+"</li>")}),b||a(".object-downloads").removeClass("is-expanded")},g=function(b,c){for(var e=!0,f=!1,g="",h=0;h<b.length;h++){var i=d.data(b[h].attr)||b[h].def;i?(g+=i+" ",b[h].label||(f=!0)):e=!1}return e?(a(c)[0].nextSibling.nodeValue=g,a(c).closest("li").removeClass("is-disabled")):(a(c)[0].nextSibling.nodeValue="",a(c).closest("li").addClass("is-disabled")),f},h=a(".object-techdata"),i=g([{attr:"file-size"},{attr:"file-unit"}],".tech-meta-filesize")|g([{attr:"runtime"},{attr:"runtime-unit",label:!0}],".tech-meta-runtime")|g([{attr:"codec"}],".tech-meta-codec")|g([{attr:"width"},{attr:"use_def",def:"x",label:!0},{attr:"height"},{attr:"size-unit",label:!0}],".tech-meta-dimensions");if(i?h.show():(h.removeClass("is-expanded"),a(".object-techdata").hide()),d.data("download-uri")){a(".object-downloads .download-button").removeClass("js-showhide").removeClass("is-disabled"),e.href=d.data("download-uri"),e.meta=[];for(var j=a(".object-techdata-list").find("li:not(.is-disabled)"),k=0;k<Math.min(2,j.length);k++)e.meta.push(a(j[k]).html())}else a(".object-downloads .download-button").addClass("js-showhide").addClass("is-disabled"),e.href="",e.meta=[];f(e.href,e.meta)};a(".media-thumbs").on("click","a",e)})}else c("no media carousel needed")},h=function(b){f(a(".more-like-this"),b)},i=function(){if("undefined"==typeof Storage&&console.log("no storage"),"undefined"!=typeof Storage){var b=sessionStorage.eu_portal_channel_label,c=sessionStorage.eu_portal_channel_name,d=sessionStorage.eu_portal_channel_url;if("undefined"!=typeof d&&"undefined"!=d){var e=a(".breadcrumbs li.js-channel"),f=e.find("a");f.text(b),f.attr("href",d),e.removeClass("js-channel")}c&&"undefined"!=c&&a("#main-menu ul a").each(function(b,d){var e=a(d);e.attr("href").indexOf("/channels/"+c)>-1&&e.addClass("is-current")})}};return{initPage:function(){e()}}});