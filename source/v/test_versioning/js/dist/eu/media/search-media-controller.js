define(["jquery","imagesLoaded"],function(a,b){function c(a){console.log("search-media-controller: "+a)}function d(){c("hideAllViewers()"),a(".media-viewer .object-media-iiif").addClass("is-hidden"),a(".media-viewer .object-media-image").addClass("is-hidden"),a(".media-viewer .object-media-text").addClass("is-hidden"),v&&(c("cleanup audio"),v.hide()),w&&(w.hide(),w=null),t&&t.hide(),u&&(c("cleanup video"),u.hide())}function e(){c("initMedia()")}function f(b){c("remove playability..."),b.$thumb.removeClass("playable"),b.$thumb.find(".media-clickable-indicator").remove(),a(q).removeClass("loading"),a(r).removeClass("loading"),a(".media-viewer .object-media-"+b.player).addClass("is-hidden")}function g(b,c){a(".media-viewer").removeClass("active")}function h(b,d){d.hide_thumb&&(a(o).addClass("open"),a(p).addClass("open"),c("hide thumb add class "+p+" and "+o)),a(q).removeClass("loading"),a(r).removeClass("loading"),a(".media-viewer").addClass("active"),"image"!=d.type&&a(".media-viewer").trigger({type:"refresh-nav-carousel"})}function i(b,e){d(),a(".media-viewer .object-media-audio").removeClass("is-hidden"),require(["media_viewer_videojs"],function(b){v=b;var d=v.getItemFromMarkup(e.target);d?v.init(d):(a(".media-viewer").trigger({type:"remove-playability",$thumb:e.target,player:"audio"}),c("missing audio item - removed"))})}function j(b,e){c("initMediaIIIF() "+e.url),d(),a(".media-viewer .object-media-iiif").removeClass("is-hidden"),require(["leaflet"],function(a){require(["media_viewer_iiif"],function(a){w=a,w.init(e.url,e.target)})})}function k(b,e){c("initMediaImage()   "+s);var g=[],h=e.target.attr("data-uri");a(q+"[data-type=image]").add(r+"[data-type=image]").each(function(){var b=a(this),d=b.attr("data-uri"),e=b.attr("data-height"),f=b.attr("data-width");d&&f&&e&&f.length>0&&e.length>0?(c("add img: "+d+", w "+f+", h "+e),g.push({src:d,h:parseInt(e),w:parseInt(f)})):c("incomplete image data")}),require(["media_viewer_image"],function(b){s=b,d(),a(".media-viewer .object-media-image").removeClass("is-hidden"),s.init(g,h)||f({$thumb:a(e.target)})})}function l(b,e){c("initMediaPdf(): "+e.url),e.url&&e.url.length>0&&(t?(d(),t.show(),t.init(e.url)):require(["jquery"],function(){require(["pdfjs"],function(){require(["pdf_lang"],function(){require(["media_viewer_pdf"],function(b){d(),a(".media-viewer .object-media-pdf").removeClass("is-hidden"),t=b,t.init(e.url)})})})}))}function m(b,e){d(),a(".media-viewer .object-media-video").removeClass("is-hidden"),require(["media_viewer_videojs"],function(b){u=b;var d=u.getItemFromMarkup(e.target);d?u.init(d):(a(".media-viewer").trigger({type:"remove-playability",$thumb:e.target,player:"video"}),c("missing video item - removed"))})}function n(b){if(b.preventDefault(),a(this).hasClass("disabled"))return void c("return because media link disabled");if(a(this).hasClass("playable")){a(this).addClass("loading");var d=a(this).attr("data-type");console.log("media controller will trigger eventobject-media-"+d),a(".media-viewer").trigger("object-media-"+d,{url:a(this).attr("data-uri"),target:a(this)})}else c("media item not playable")}var o=".object-media-nav",p=".single-item-thumb",q=o+" a",r=p+" a",s=(a(q).length>1,null),t=null,u=null,v=null,w=null;a(".media-viewer").on("media_init",e),a(".media-viewer").on("object-media-audio",i),a(".media-viewer").on("object-media-iiif",j),a(".media-viewer").on("object-media-image",k),a(".media-viewer").on("object-media-pdf",l),a(".media-viewer").on("object-media-video",m),a(".media-viewer").on("object-media-open",h),a(".media-viewer").on("object-media-close",g),a(".media-viewer").on("remove-playability",f),a(o).on("click","a",n),a(r).on("click",n)});